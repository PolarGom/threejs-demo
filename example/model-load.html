<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>2. 3D Model Load Demo</title>
		<style>
			body { margin: 0; }
			#info {
				position: absolute;
				top: 10px;
				width: 100%;
				text-align: center;
				z-index: 100;
				display:block;
				color: white;
			}
		</style>
	</head>
	<body>
		<div id="info">2. 3D Model Load Demo</div>

		<script async src="https://unpkg.com/es-module-shims@1.3.6/dist/es-module-shims.js"></script>
		<script type="importmap">
			{
				"imports": {
					"three": "../jsm/three.module.js"
				}
			}
		</script>
		<script type="module">
			import * as THREE from 'three'
			import WebGL from '../jsm/capabilities/WebGL.js'
			import { OrbitControls } from '../jsm/controls/OrbitControls.js'
			import { GLTFLoader } from '../jsm/loaders/GLTFLoader.js'

			if (!WebGL.isWebGLAvailable()) {
				const warning = WebGL.getWebGLErrorMessage()
				document.body.appendChild(warning)
			}

			const clock = new THREE.Clock()
			const scene = new THREE.Scene()
			const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000)
			const renderer = new THREE.WebGLRenderer()
			renderer.setSize(window.innerWidth, window.innerHeight)

			document.body.appendChild(renderer.domElement)

			const controls = new OrbitControls(camera, renderer.domElement)

			// 빛을 추가하지 않는 다면 로드된 Model 은 보이지 않는다.
			scene.add(createAmbientLight())
			scene.add(createDirectionalLight())

			camera.position.set(0, 50, 150)

			let mixer = null

			loadModel()
			animate()

			function loadModel() {
				const loader = new GLTFLoader()
				loader.load('../resources/model/Fox.glb', function (gltf) {
					let object = gltf.scene
					object.position.set(0, 0, 0)

					scene.add(object)

					mixer = new THREE.AnimationMixer(object)
					mixer.clipAction(gltf.animations[0]).play()
				}, undefined, function (error) {
					console.error(error)
				})
			}

			function createAmbientLight() {
				const ambientLight = new THREE.AmbientLight(0xcccccc)

				return ambientLight
			}

			function createDirectionalLight() {
				let directionalLight = new THREE.DirectionalLight(0xffffff)
				directionalLight.position.set(0, 1, 1).normalize()

				return directionalLight
			}

			function animate() {
				try {
					requestAnimationFrame(animate)

					// getDelta: 이전 시간에서 현재 시간을 뺀 값
					if (mixer !== null) {
						mixer.update(clock.getDelta())
					}

					renderer.render(scene, camera)
				} catch(e) {
					console.log(e)
				}
			}
		</script>
	</body>
</html>